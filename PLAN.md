# План разработки quickPOS

## Текущее состояние проекта

### ✅ Что уже готово:
- Модели базы данных (SQLAlchemy) - 13 моделей
- Настройка подключения к PostgreSQL (асинхронное)
- Конфигурация базы данных
- Структура проекта

### ❌ Что нужно реализовать:
- Backend API (FastAPI)
- Frontend интерфейс
- Аутентификация и авторизация
- Управление зависимостями
- Документация API

---

## Этап 1: Настройка инфраструктуры (Приоритет: Высокий)

### 1.1 Управление зависимостями
- [ ] Создать `requirements.txt` с необходимыми пакетами:
  - FastAPI
  - uvicorn
  - sqlalchemy
  - asyncpg
  - pydantic
  - python-jose (JWT)
  - passlib (хеширование паролей)
  - python-multipart (для загрузки файлов)
  - python-dotenv (для переменных окружения)

### 1.2 Конфигурация проекта
- [ ] Создать `.env` файл для переменных окружения
- [ ] Обновить `dbconfig.py` для чтения из `.env`
- [ ] Добавить `.env.example` в репозиторий
- [ ] Обновить `.gitignore` для исключения `.env`

### 1.3 Структура проекта
- [ ] Создать структуру папок:
  ```
  backend/
    app/
      api/
        v1/
          endpoints/
            auth.py
            users.py
            products.py
            sales.py
            employees.py
            ...
          router.py
      core/
        config.py
        security.py
        dependencies.py
      schemas/
        user.py
        product.py
        sale.py
        ...
      services/
        auth_service.py
        product_service.py
        sale_service.py
        ...
      crud/
        base.py
        user.py
        product.py
        ...
      models.py
      database.py
      main.py
  ```

---

## Этап 2: Backend API - Базовая инфраструктура (Приоритет: Высокий)

### 2.1 Основное приложение FastAPI
- [ ] Настроить `main.py` с FastAPI приложением
- [ ] Добавить CORS middleware
- [ ] Настроить роутинг API v1
- [ ] Добавить обработку исключений
- [ ] Настроить логирование

### 2.2 Безопасность и аутентификация
- [ ] Реализовать хеширование паролей (bcrypt)
- [ ] Создать JWT токены для аутентификации
- [ ] Реализовать эндпоинты:
  - POST `/api/v1/auth/login` - вход в систему
  - POST `/api/v1/auth/logout` - выход
  - GET `/api/v1/auth/me` - текущий пользователь
- [ ] Создать зависимости для проверки токенов
- [ ] Реализовать систему ролей и разрешений

### 2.3 База данных
- [ ] Создать функции для получения сессии БД
- [ ] Реализовать миграции (Alembic)
- [ ] Создать базовые CRUD операции

---

## Этап 3: Backend API - Основные модули (Приоритет: Высокий)

### 3.1 Схемы Pydantic
- [ ] Создать схемы для всех моделей:
  - User schemas (Create, Update, Response)
  - Product schemas (Good, GoodCat)
  - Sale schemas (Check, Sale, Item)
  - Employee schemas
  - Batch schemas
  - Discount schemas
  - Service schemas
  - VATRate schemas

### 3.2 CRUD операции
- [ ] Базовый CRUD класс с общими операциями
- [ ] CRUD для каждой сущности:
  - Users CRUD
  - Products CRUD (Goods, GoodCats)
  - Sales CRUD (Checks, Sales, Items)
  - Employees CRUD
  - Batches CRUD
  - Discounts CRUD
  - Services CRUD
  - VATRates CRUD

### 3.3 API Endpoints

#### 3.3.1 Управление пользователями
- [ ] GET `/api/v1/users` - список пользователей
- [ ] GET `/api/v1/users/{id}` - получить пользователя
- [ ] POST `/api/v1/users` - создать пользователя
- [ ] PUT `/api/v1/users/{id}` - обновить пользователя
- [ ] DELETE `/api/v1/users/{id}` - удалить пользователя (soft delete)

#### 3.3.2 Управление товарами
- [ ] GET `/api/v1/products` - список товаров
- [ ] GET `/api/v1/products/{id}` - получить товар
- [ ] POST `/api/v1/products` - создать товар
- [ ] PUT `/api/v1/products/{id}` - обновить товар
- [ ] DELETE `/api/v1/products/{id}` - удалить товар
- [ ] GET `/api/v1/products/categories` - список категорий
- [ ] POST `/api/v1/products/categories` - создать категорию
- [ ] GET `/api/v1/products/search` - поиск товаров

#### 3.3.3 Управление партиями
- [ ] GET `/api/v1/batches` - список партий
- [ ] GET `/api/v1/batches/{id}` - получить партию
- [ ] POST `/api/v1/batches` - создать партию
- [ ] PUT `/api/v1/batches/{id}` - обновить партию
- [ ] GET `/api/v1/batches/product/{good_id}` - партии товара
- [ ] POST `/api/v1/batches/{id}/write-off` - списание партии

#### 3.3.4 Продажи
- [ ] POST `/api/v1/sales/check` - создать чек
- [ ] GET `/api/v1/sales/checks` - список чеков
- [ ] GET `/api/v1/sales/checks/{id}` - получить чек
- [ ] GET `/api/v1/sales/reports/daily` - дневной отчет
- [ ] GET `/api/v1/sales/reports/period` - отчет за период
- [ ] POST `/api/v1/sales/add-item` - добавить товар в чек
- [ ] DELETE `/api/v1/sales/remove-item/{item_id}` - удалить товар из чека

#### 3.3.5 Сотрудники
- [ ] GET `/api/v1/employees` - список сотрудников
- [ ] GET `/api/v1/employees/{id}` - получить сотрудника
- [ ] POST `/api/v1/employees` - создать сотрудника
- [ ] PUT `/api/v1/employees/{id}` - обновить сотрудника
- [ ] DELETE `/api/v1/employees/{id}` - удалить сотрудника

#### 3.3.6 Скидки
- [ ] GET `/api/v1/discounts` - список скидок
- [ ] POST `/api/v1/discounts` - создать скидку
- [ ] PUT `/api/v1/discounts/{id}` - обновить скидку
- [ ] DELETE `/api/v1/discounts/{id}` - удалить скидку

#### 3.3.7 Услуги
- [ ] GET `/api/v1/services` - список услуг
- [ ] POST `/api/v1/services` - создать услугу
- [ ] PUT `/api/v1/services/{id}` - обновить услугу
- [ ] DELETE `/api/v1/services/{id}` - удалить услугу

#### 3.3.8 НДС ставки
- [ ] GET `/api/v1/vat-rates` - список ставок НДС
- [ ] POST `/api/v1/vat-rates` - создать ставку НДС
- [ ] PUT `/api/v1/vat-rates/{id}` - обновить ставку НДС

---

## Этап 4: Бизнес-логика (Приоритет: Средний)

### 4.1 Логика продаж
- [ ] Реализовать создание чека с товарами
- [ ] Расчет общей суммы чека
- [ ] Применение скидок
- [ ] Расчет НДС
- [ ] Управление остатками (списание из партий)
- [ ] Проверка срока годности товаров

### 4.2 Управление партиями
- [ ] Автоматическое списание по FIFO/LIFO
- [ ] Проверка остатков перед продажей
- [ ] Уведомления о скором истечении срока годности

### 4.3 Отчетность
- [ ] Дневные отчеты по продажам
- [ ] Отчеты за период
- [ ] Отчеты по сотрудникам
- [ ] Отчеты по товарам
- [ ] Экспорт отчетов (CSV, PDF)

---

## Этап 5: Frontend (Приоритет: Высокий)

### 5.1 Выбор технологии
- [ ] Выбрать фреймворк (React/Vue/Angular или простой HTML+JS)
- [ ] Настроить сборку проекта

### 5.2 Основные страницы
- [ ] Страница входа (Login)
- [ ] Главная страница (Dashboard)
- [ ] Страница продаж (POS интерфейс)
- [ ] Управление товарами
- [ ] Управление сотрудниками
- [ ] Отчеты

### 5.3 POS интерфейс
- [ ] Поиск товаров по штрих-коду
- [ ] Добавление товаров в чек
- [ ] Редактирование количества
- [ ] Применение скидок
- [ ] Печать чека
- [ ] Оплата

### 5.4 Компоненты
- [ ] Компонент поиска товаров
- [ ] Компонент корзины
- [ ] Компонент чека
- [ ] Компонент отчетов
- [ ] Компонент управления товарами

---

## Этап 6: Дополнительные функции (Приоритет: Низкий)

### 6.1 Штрих-коды
- [ ] Генерация штрих-кодов
- [ ] Сканирование штрих-кодов
- [ ] Связь штрих-кодов с партиями

### 6.2 Изображения товаров
- [ ] Загрузка изображений товаров
- [ ] Хранение изображений
- [ ] API для получения изображений

### 6.3 Печать
- [ ] Генерация чека для печати
- [ ] Интеграция с принтерами
- [ ] Шаблоны чеков

### 6.4 Резервное копирование
- [ ] Автоматическое резервное копирование БД
- [ ] Восстановление из резервной копии

---

## Этап 7: Тестирование и документация (Приоритет: Средний)

### 7.1 Тестирование
- [ ] Unit тесты для CRUD операций
- [ ] Unit тесты для бизнес-логики
- [ ] Integration тесты для API
- [ ] Тесты аутентификации

### 7.2 Документация
- [ ] Обновить README.md
- [ ] Документация API (автоматическая через FastAPI)
- [ ] Документация по развертыванию
- [ ] Руководство пользователя

---

## Этап 8: Оптимизация и деплой (Приоритет: Низкий)

### 8.1 Оптимизация
- [ ] Оптимизация запросов к БД
- [ ] Кэширование часто используемых данных
- [ ] Индексы в БД
- [ ] Оптимизация фронтенда

### 8.2 Деплой
- [ ] Настройка Docker контейнеров
- [ ] Docker Compose для разработки
- [ ] Настройка CI/CD
- [ ] Инструкции по развертыванию

---

## Приоритеты разработки

### MVP (Минимально жизнеспособный продукт):
1. ✅ Этап 1 - Настройка инфраструктуры
2. ✅ Этап 2 - Backend API базовая инфраструктура
3. ✅ Этап 3.1, 3.2, 3.3.2, 3.3.4 - Товары и продажи
4. ✅ Этап 2.2 - Аутентификация
5. ✅ Этап 5.3 - POS интерфейс

### После MVP:
- Остальные CRUD операции
- Отчетность
- Управление сотрудниками
- Дополнительные функции

---

## Оценка времени

- **Этап 1**: 2-3 дня
- **Этап 2**: 3-5 дней
- **Этап 3**: 7-10 дней
- **Этап 4**: 5-7 дней
- **Этап 5**: 10-14 дней
- **Этап 6**: 5-7 дней
- **Этап 7**: 3-5 дней
- **Этап 8**: 3-5 дней

**Общая оценка**: 38-56 дней разработки

---

## Заметки

- Использовать async/await везде, где возможно
- Следовать принципам REST API
- Использовать soft delete для всех сущностей
- Валидация данных на уровне схем Pydantic
- Логирование всех важных операций
- Обработка ошибок с понятными сообщениями

